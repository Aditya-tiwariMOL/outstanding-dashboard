<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Outstanding Receivables Dashboard</title>

<style>
:root {
  --brand:#0B419B;
  --bg:#f4f6fa;
  --border:#e3e8f2;
}

body {
  margin:0;
  font-family:Inter, Arial, sans-serif;
  background:var(--bg);
}

.container {
  max-width:1200px;
  margin:auto;
  padding:16px;
}

h1 { color:var(--brand); }
.total { font-size:36px; font-weight:700; }
.updated { color:#555; margin-bottom:16px; }

.table-wrap {
  background:#fff;
  border-radius:10px;
  overflow-x:auto;
}

table {
  width:100%;
  border-collapse:collapse;
  min-width:900px;
}

th {
  background:#eef3fb;
  color:var(--brand);
  padding:12px;
  text-align:left;
}

td {
  padding:12px;
  border-top:1px solid var(--border);
}

.pic {
  font-weight:700;
  cursor:pointer;
  border-left:4px solid var(--brand);
}

.customer {
  background:#fafbfd;
  cursor:pointer;
}

.invoice {
  font-style:italic;
  color:#555;
}

.bad { color:#d92d20; font-weight:700; }

/* MOBILE */
.mobile { display:none; }
.card {
  background:#fff;
  border-radius:10px;
  padding:14px;
  margin-bottom:12px;
  border-left:5px solid var(--brand);
}
.row { display:flex; justify-content:space-between; margin:4px 0; }
.sub { background:#f7f9fc; margin-top:10px; padding:10px; border-radius:8px; }
.inv { font-size:13px; margin-left:8px; }

@media(max-width:768px){
  .table-wrap { display:none; }
  .mobile { display:block; }
}
</style>
</head>

<body>
<div class="container">
  <h1>Outstanding Receivables Dashboard</h1>
  <div class="total" id="grandTotal">₹ 0</div>
  <div class="updated" id="updated"></div>

  <!-- DESKTOP -->
  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>Sales PIC</th>
          <th>Total</th>
          <th>90+</th>
          <th>61–90</th>
          <th>31–60</th>
          <th>1–30</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>

  <!-- MOBILE -->
  <div class="mobile" id="mobile"></div>
</div>

<script>
const API_URL = "PASTE_YOUR_APPS_SCRIPT_URL";

fetch(API_URL)
.then(r=>r.json())
.then(data=>{
  document.getElementById("grandTotal").innerText =
    "₹ " + data.grandTotal.toLocaleString("en-IN");
  document.getElementById("updated").innerText =
    "Last updated: " + new Date(data.lastUpdated).toLocaleString();

  renderDesktop(data.salesPICs);
  renderMobile(data.salesPICs);
});

function clearNonPICRows() {
  document.querySelectorAll("tr[data-type]").forEach(r=>r.remove());
}

function renderDesktop(pics) {
  const tb = document.getElementById("tbody");
  tb.innerHTML = "";

  Object.entries(pics).forEach(([pic,p])=>{
    const tr = document.createElement("tr");
    tr.className="pic";
    tr.dataset.pic=pic;
    tr.innerHTML = rowHTML("▶ "+pic,p);
    tr.onclick = ()=>togglePIC(tr,p.customers);
    tb.appendChild(tr);
  });
}

function togglePIC(picRow, customers) {
  clearNonPICRows();

  Object.entries(customers).forEach(([c,cObj])=>{
    const tr = document.createElement("tr");
    tr.className="customer";
    tr.dataset.type="customer";
    tr.dataset.parent=picRow.dataset.pic;
    tr.innerHTML = rowHTML("▶ "+c,cObj,20);
    tr.onclick = e=>{
      e.stopPropagation();
      toggleCustomer(tr,cObj.invoices);
    };
    picRow.after(tr);
    picRow = tr;
  });
}

function toggleCustomer(customerRow, invoices) {
  document.querySelectorAll("tr[data-type='invoice']").forEach(r=>r.remove());

  invoices.forEach(inv=>{
    const tr = document.createElement("tr");
    tr.className="invoice";
    tr.dataset.type="invoice";
    tr.innerHTML = rowHTML(inv.invoiceNo,inv,40);
    customerRow.after(tr);
    customerRow = tr;
  });
}

function rowHTML(label,o,pad=0){
  return `
    <td style="padding-left:${pad}px">${label}</td>
    <td>${fmt(o.total)}</td>
    <td class="${o.d90?'bad':''}">${fmt(o.d90)}</td>
    <td>${fmt(o.d61_90)}</td>
    <td>${fmt(o.d31_60)}</td>
    <td>${fmt(o.d1_30)}</td>`;
}

/* MOBILE */
function renderMobile(pics){
  const box=document.getElementById("mobile");
  box.innerHTML="";
  Object.entries(pics).forEach(([pic,p])=>{
    const c=document.createElement("div");
    c.className="card";
    c.innerHTML=`
      <b>${pic}</b>
      <div class="row"><span>Total</span><b>${fmt(p.total)}</b></div>
      <div class="row"><span>90+</span><b class="bad">${fmt(p.d90)}</b></div>`;
    c.onclick=()=>{
      c.querySelectorAll(".sub").forEach(e=>e.remove());
      Object.entries(p.customers).forEach(([cn,co])=>{
        const s=document.createElement("div");
        s.className="sub";
        s.innerHTML="<b>"+cn+"</b>";
        co.invoices.forEach(i=>{
          s.innerHTML+=`<div class="inv">${i.invoiceNo} – ₹ ${fmt(i.total)}</div>`;
        });
        c.appendChild(s);
      });
    };
    box.appendChild(c);
  });
}

function fmt(v){ return v ? v.toLocaleString("en-IN") : "–"; }
</script>
</body>
</html>
