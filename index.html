<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Outstanding Receivables</title>
<style>
:root{--brand:#0B419B;--bg:#f4f7fb}
body{margin:0;font-family:system-ui;background:var(--bg)}
.container{max-width:1200px;margin:auto;padding:16px}
table{width:100%;border-collapse:collapse;background:#fff}
th,td{padding:12px;border-top:1px solid #ddd}
th{background:#eef3ff;color:var(--brand)}
.customer{padding-left:18px}
.forecast-input{width:120px;padding:6px}
.submit{margin:20px;text-align:center}
button{background:var(--brand);color:#fff;border:none;padding:12px 24px;border-radius:8px}
</style>
</head>

<body>
<div class="container">
  <h2>Outstanding Receivables</h2>
  <table>
    <thead>
      <tr>
        <th>Customer</th><th>Forecast</th><th>Total</th>
      </tr>
    </thead>
    <tbody id="body"></tbody>
  </table>

  <div class="submit" id="submitWrap" style="display:none">
    <button onclick="submitAll()">Submit Forecasts</button>
  </div>
</div>

<script>
const API="https://script.google.com/macros/s/AKfycbzmQV1ULJx-CZyqWanibqRuj5UV5qSmChaTFoCzIrNUBIRF9ST6tVr1JQ8w-GxdR1oB/exec";
let edits={}, activePIC=null;

fetch(API).then(r=>r.json()).then(d=>{
  activePIC=Object.keys(d.salesPICs)[0];
  const customers=d.salesPICs[activePIC].customers;
  for(const c in customers){
    body.innerHTML+=`
      <tr>
        <td class="customer">${c}</td>
        <td><input class="forecast-input"
          oninput="edit('${c}',this.value)"></td>
        <td>${customers[c].total}</td>
      </tr>`;
  }
});

function edit(c,v){
  edits[c]=v;
  submitWrap.style.display="block";
}

function submitAll(){
  Object.entries(edits).forEach(([customer,forecast])=>{
    fetch(API,{
      method:"POST",
      headers:{ "Content-Type":"application/x-www-form-urlencoded" },
      body:`pic=${encodeURIComponent(activePIC)}&customer=${encodeURIComponent(customer)}&forecast=${forecast}`
    });
  });
  alert("Forecasts saved");
}
</script>
</body>
</html>
