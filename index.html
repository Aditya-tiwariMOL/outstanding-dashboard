<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Outstanding Receivables Dashboard</title>

<style>
:root{
  --brand:#0B419B;
  --bg:#f4f7fb;
  --border:#e2e6ef;
  --red:#d93025;
  --green:#188038;
}

*{ box-sizing:border-box }

body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  background:var(--bg);
  font-size:110%; /* ðŸ”¼ overall font +10% */
}

/* HEADER */
.header{
  text-align:center;
  padding:16px 8px;
}

.header h1{
  margin:0;
  font-size:18px;
  font-weight:700;
  color:var(--brand);
}

.amount{
  font-size:24px;
  font-weight:800;
}

.updated{
  font-size:13px;
  color:#666;
}

/* CONTAINER */
.container{
  max-width:1200px;
  margin:auto;
  padding:14px;
}

/* TABLE */
.table-wrap{
  background:#fff;
  border-radius:14px;
  overflow-x:auto;
  box-shadow:0 6px 20px rgba(0,0,0,.04);
}

table{
  width:100%;
  border-collapse:collapse;
}

th{
  background:#eef3ff;
  color:var(--brand);
  padding:12px 16px; /* ðŸ”¼ more spacing */
  font-size:14px;
  text-align:left;
  white-space:nowrap;
}

td{
  padding:12px 16px; /* ðŸ”¼ more spacing */
  border-top:1px solid var(--border);
  vertical-align:top;
  text-align:left;
}

/* ROW TYPES */
.click{ cursor:pointer }

/* Sales PIC */
.sales{
  font-size:15px;
  font-weight:800;
  white-space:nowrap;
}

/* CUSTOMER */
.customer{
  font-size:13px;
  font-weight:400;
  padding-left:28px;
  background:#fafcff;
  white-space:normal;
  word-break:break-word;
  max-width:200px;
}

/* INVOICE */
.invoice{
  font-size:12px;
  font-style:italic;
  color:#444;
  padding-left:48px;
  white-space:nowrap;
}

/* AMOUNTS */
.amount-cell{
  font-size:14px;
  white-space:nowrap;
  min-width:90px; /* ðŸ”¼ wider numeric columns */
}

.total{
  font-weight:800;
  color:#000;
}

.green{
  color:var(--green);
  font-weight:700;
}

.red{
  color:var(--red);
  font-weight:700;
}

/* LOADER */
.loader{
  position:fixed;
  inset:0;
  background:var(--bg);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:18px;
  font-weight:700;
  color:var(--brand);
  z-index:9999;
}
</style>
</head>

<body>

<div id="loader" class="loader">Loading outstanding dataâ€¦</div>

<div class="header">
  <h1>Outstanding Receivables Dashboard</h1>
  <div class="amount" id="grandTotal">â‚¹ 0</div>
  <div class="updated" id="updated"></div>
</div>

<div class="container">
  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>Sales PIC</th>
          <th>Total</th>
          <th>On Account</th>
          <th>90+</th>
          <th>61â€“90</th>
          <th>31â€“60</th>
          <th>1â€“30</th>
        </tr>
      </thead>
      <tbody id="body"></tbody>
    </table>
  </div>
</div>

<script>
const API_URL =
"https://script.google.com/macros/s/AKfycbzmQV1ULJx-CZyqWanibqRuj5UV5qSmChaTFoCzIrNUBIRF9ST6tVr1JQ8w-GxdR1oB/exec";

let DATA={}, activeSales=null;

fetch(API_URL)
.then(r=>r.json())
.then(init);

function init(json){
  DATA=json.salesPICs;

  /* FULL NUMBER in heading */
  document.getElementById("grandTotal").textContent =
    "â‚¹ " + json.grandTotal.toLocaleString("en-IN");

  document.getElementById("updated").textContent =
    "Last updated: " + new Date(json.lastUpdated).toLocaleString();

  renderSales();
  document.getElementById("loader").style.display="none";
}

function clearBody(){ body.innerHTML=""; }

function renderSales(){
  clearBody(); activeSales=null;
  Object.entries(DATA).forEach(([n,s])=>{
    addRow(n,"sales click",s,()=>openSales(n),"sales");
  });
}

function openSales(name){
  clearBody(); activeSales=name;
  const s=DATA[name];
  addRow(name,"sales click",s,renderSales,"sales");

  Object.entries(s.customers).forEach(([c,v])=>{
    addRow(c,"customer click",v,()=>openCustomer(c),"customer");
  });
}

function openCustomer(cust){
  clearBody();
  const s=DATA[activeSales];
  addRow(activeSales,"sales click",s,renderSales,"sales");

  Object.entries(s.customers).forEach(([c,v])=>{
    if(c!==cust){
      addRow(c,"customer click",v,()=>openCustomer(c),"customer");
    }else{
      addRow(c,"customer click",v,()=>openSales(activeSales),"customer");
      v.invoices.forEach(inv=>{
        addRow(inv.invoiceNo,"invoice",inv,null,"invoice");
      });
    }
  });
}

function addRow(label,cls,val,click,type){
  const tr=document.createElement("tr");
  const td0=document.createElement("td");
  td0.textContent=label;
  td0.className=cls;
  if(click) td0.onclick=click;
  tr.appendChild(td0);

  tr.appendChild(makeTD(val.total,"total"));
  tr.appendChild(makeTD(type==="customer"?val.onAccount:0,"green"));
  tr.appendChild(makeTD(val.d90,"red"));
  tr.appendChild(makeTD(val.d61_90));
  tr.appendChild(makeTD(val.d31_60));
  tr.appendChild(makeTD(val.d1_30));

  body.appendChild(tr);
}

function makeTD(v,cls=""){
  const td=document.createElement("td");
  td.className="amount-cell "+cls;
  td.textContent=v?formatAmount(v):"â€“";
  return td;
}

function formatAmount(v){
  if(v>=100000) return "â‚¹"+(v/100000).toFixed(1).replace(".0","")+"L";
  if(v>=1000) return "â‚¹"+Math.round(v/1000)+"k";
  return "â‚¹"+v;
}
</script>

</body>
</html>
